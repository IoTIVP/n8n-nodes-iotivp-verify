# IoTIVP Verify (Gateway) â€” SPEC

## 1. Webhook â€” â€œIoT Sensor Ingestâ€

The workflow begins with an HTTP Webhook receiving packets from IoT devices.

Example Input:

    {
      "device_id": 42,
      "packet_hex": "0102a10f7fff93b2"
    }

The content of packet_hex does not matter in Fake-Verifier Mode, but it mimics real binary transmission.

## 2. IoTIVP Verify (Gateway) â€” Fake-Verifier Mode

The IoTIVP Verify (Gateway) node receives the incoming item and attaches two simulated objects:

    - core_packet      (IoTIVP-Core format)
    - verify_result    (IoTIVP-Verify validation output)

These values are generated in Fake-Verifier Mode and do not rely on real binary parsing or cryptographic hashing.

Example Output Structure:

    {
      "device_id": 42,
      "packet_hex": "0102a10f7fff93b2",

      "core_packet": {
        "header": 1,
        "timestamp": 1732212000,
        "device_id": 42,
        "nonce": 7,
        "fields": {
          "temperature": 25.4,
          "humidity": 52,
          "battery": 91
        },
        "hash": "f4a291bc",
        "_meta": {
          "mode": "fake-verifier",
          "packet_hex_seen": true
        }
      },

      "verify_result": {
        "valid": true,
        "integrity_score": 92,
        "flags": {
          "hash_mismatch": false,
          "timestamp_expired": false,
          "nonce_reuse": false,
          "value_out_of_range": []
        },
        "_meta": {
          "mode": "fake-verifier"
        }
      }
    }

This simulated output establishes the expected IoTIVP-Core and IoTIVP-Verify formats long before real decoding and verification logic are implemented.

## 3. IF Node â€” â€œIntegrity OK?â€

The workflow evaluates the integrity of the incoming IoT packet using the score generated by the IoTIVP Verify (Gateway) node.

Integrity Condition:

    verify_result.integrity_score >= 80

Branch Logic:

    - TRUE  â†’ Packet is considered trusted and moves into the Trusted Branch.
    - FALSE â†’ Packet is considered untrusted and moves into the Untrusted Branch.

In Fake-Verifier Mode:
    - integrity_score is always 92.
    - Therefore, all packets flow through the TRUE (trusted) branch.

This condition will become meaningful once real verification logic is implemented.

## 4. Trusted Branch â€” Save or Use Sensor Data

High-integrity packets flow into the trusted pipeline. These packets are considered valid, untampered, and safe to use in downstream automation.

Possible downstream actions:

    - Append to Google Sheets
    - Insert into PostgreSQL / MySQL
    - Publish to MQTT for robotics or edge devices
    - Forward to dashboards or digital twins
    - Trigger automation based on clean, verified telemetry

Example trusted row (Google Sheets):

    | timestamp   | device_id | temperature | humidity | battery | integrity_score |
    |-------------|-----------|-------------|----------|---------|-----------------|
    | 1732212000  | 42        | 25.4        | 52       | 91      | 92              |

This branch represents the final destination for verified, high-confidence IoT data that passes all integrity checks.

## 5. Untrusted Branch â€” Quarantine or Alert

Packets that fail integrity validation (once real Verify logic is active) are routed into the Untrusted Branch. These packets may indicate tampering, corruption, replay attempts, or device malfunction.

Possible downstream actions:

    - Send an alert via Telegram / Slack / Email
    - Log packet details to a "Quarantine" database or Google Sheet
    - Trigger a forensic or incident-response workflow
    - Store raw packet data for later investigation
    - Notify system operators or security teams

Purpose of this branch:

    - Prevent unverified or suspicious data from influencing automations
    - Create a clean separation between trusted and untrusted telemetry
    - Provide early detection of anomalous or malicious device activity

This branch becomes mission-critical when real verification is implemented, as it contains all packets that cannot be trusted.

## 6. Purpose Summary

This example workflow demonstrates how IoTIVP Verify (Gateway) functions as a trust-first layer inside an n8n automation environment.

Key objectives:

    - Establish a clear separation between trusted and untrusted IoT data
    - Provide a standardized structure for IoTIVP-Core and IoTIVP-Verify output
    - Enable early testing and workflow design using Fake-Verifier Mode
    - Offer a portfolio-ready demonstration of IoT data integrity enforcement
    - Prepare downstream systems (databases, dashboards, robotics, alerts) to rely on verified data

As real decoding and verification logic is implemented, this workflow will evolve into a full integrity pipeline. The structure shown here remains stable, ensuring long-term compatibility with future IoTIVP-Core, IoTIVP-Binary, and IoTIVP-Verify releases.

This marks the first canonical integration pattern for IoTIVP inside n8n.

...

# Example Workflow 2 â€” Robotics Integrity Gate (Fake-Verifier Mode)

This workflow demonstrates how the IoTIVP Verify (Gateway) node acts as a safety and trust layer inside a robotics automation pipeline. Mobile robots rely on clean, untampered, high-accuracy sensor data. IoTIVP enforces integrity BEFORE the robot controller accepts any telemetry.

Fake-Verifier Mode is used here until real binary decoding and verification logic are implemented.

---

## ðŸ›  Workflow Overview

    [Robot Sensor Packet Ingest]
                â†“
    [IoTIVP Verify (Gateway)]
                â†“
      [IF: Integrity â‰¥ 85?]
           â†™                â†˜
[Trusted Robotics Data]   [Unsafe / Suspicious Data]

---

## 1. Sensor Packet Ingest â€” â€œRobot Telemetryâ€

Robotic systems (ESP32, ROS/ROS2 nodes, or custom hardware) send binary packets into n8n.

Example Input:

    {
      "robot_id": "alpha-unit-03",
      "packet_hex": "88f31002aa7f349fe181..."
    }

This represents IMU, ToF, encoder, or low-rate LiDAR summaries.

---

## 2. IoTIVP Verify (Gateway) â€” Fake-Verifier Mode

The node attaches simulated IoTIVP-Core and IoTIVP-Verify results.

Example Output:

    {
      "robot_id": "alpha-unit-03",

      "core_packet": {
        "header": 1,
        "timestamp": 1732212005,
        "device_id": 103,
        "nonce": 12,
        "fields": {
          "imu_ax": 0.03,
          "imu_ay": -0.01,
          "imu_az": 9.81,
          "distance_cm": 142,
          "battery": 87
        },
        "hash": "9ac3f2d1",
        "_meta": {
          "mode": "fake-verifier",
          "packet_hex_seen": true
        }
      },

      "verify_result": {
        "valid": true,
        "integrity_score": 88,
        "flags": {
          "hash_mismatch": false,
          "timestamp_expired": false,
          "nonce_reuse": false,
          "value_out_of_range": []
        },
        "_meta": {
          "mode": "fake-verifier"
        }
      }
    }

---

## 3. IF Node â€” â€œIs This Robotics Data Safe?â€

Robotics requires stricter trust margins.

Integrity Condition:

    verify_result.integrity_score >= 85

Branch logic:

    - TRUE â†’ Data is safe for navigation or processing
    - FALSE â†’ Data is unsafe and must be isolated

Even a single tampered packet can cause:
    - navigation drift
    - failed obstacle detection
    - mapping corruption
    - unsafe actuator behavior

---

## 4. Trusted Robotics Data â€” Fusion, Control, Missions

High-integrity packets flow into the robotâ€™s control system.

Possible actions:

    - Publish clean data to MQTT robotics topics
    - Forward to ROS/ROS2 bridge
    - Feed into SLAM or sensor-fusion modules
    - Update robot state estimation (odometry, IMU)
    - Log normal operation metrics

Example safe publish:

    topic: robot/alpha-unit-03/telemetry
    payload:
        {
          "distance_cm": 142,
          "imu": [0.03, -0.01, 9.81],
          "battery": 87,
          "integrity": 88
        }

---

## 5. Unsafe / Suspicious Data â€” Quarantine & Alert

If a packet appears tampered or fails verification, it is blocked.

Possible actions:

    - Issue Robotics Safety Alert (Telegram / Slack)
    - Write event to "Robot Safety Log"
    - Pause navigation (soft-stop)
    - Trigger emergency-stop if required
    - Save raw packet for forensics

Example alert message:

    ALERT: Suspicious telemetry detected from alpha-unit-03.
    Action: Navigation paused.

---

## Purpose of This Workflow

This example shows IoTIVP as a **robotics safety filter**, ensuring that telemetry is:

    - trustworthy
    - untampered
    - valid
    - fresh
    - safe to use for motion planning and control

Robotics systems demand deterministic, high-confidence data â€” IoTIVP provides the integrity layer that makes that possible.

This is the second official integration pattern for IoTIVP inside n8n.

